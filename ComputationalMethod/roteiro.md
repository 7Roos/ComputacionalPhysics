# Derivada numérica
## Introdução
Bem-vindo ao canal! Esse é o primeiro de uma śerie de conteúdos envolvendo métodos computacionais, isto é, cálculo numérico e sua implmentação computacional. Hoje vamos derivar através das diferenças finitas a fórmula da derivada de dois pontos forward e backward. Cada método ou fórmula, será divido em duas partes; dedução analítica e implementação computacional. Na primeira etapa vamos deduzir as equações envolvidas, escrever pseudo-códigos e desenhar fluxogramas. Mantendo assim um caráter mais geral e independente da linguagem computacional. E então na última parte, vamos implementar os códigos nas três principais linguagens de programação científicas que eu vejo na atualidade; Fortran, Python e Julia, bem como o uso dos softwares gráficos correspondentes destas linguagens, como gnuplot e matplotlib. Ao final dessa série, vamos construir um módulo/biblioteca de cálculo numérico. Quanto a bibliografia principal, será de um importante livro de física computacional (título na descrição) bem como demais livros de física computacional.

Neste capítulo de derivadas numéricas, vou deduzir as fórmulas das derivadas, implementar nas linguagens Fortran, Python e Julia. Ao final, vamos comparar o comportamento para diferentes funções e parâmetros. Outra verificação, porém menos importante, será entre estas trẽs linguagens em si, vamos analisar a verbosidade, tempo de execução e uso de memória. Porém, acredito que os valores de desempenho não terão diferenças significativas. Além disso, os programas são melhor escritos, quanto maior é o conhecimento do desenvolvedor sobre o problema e a linguagem, então não leve para o coração os valores que obterei de desempenho. 

Apresentadas as minhas intenções, vamos ao conteúdo de fato.

## Motivação
Suponha que temos a capacidade de calcular o valor de uma função f(x) em qualquer valor da variável independente 'X'. Além disso, suponha também que essa função é bem comportada no intervalo de interesse. Nós podemos procurar a derivada de 'F' em um determinado ponto. Se 'F' é conhecida analiticamente, quase sempre é possivel derivar fórmulas explícitas para as derivadas de 'F'. No entanto, em muitas ocasiões o método analítico não pode ser utilizado, embora possamos avaliar 'F' de 'X'. Isso pode ocorrer devido a necessidade de alguns procedimentos numéricos muito complicados e de não termos uma representação analítica, ou, pior ainda, porque a forma como podemos gerar 'F' fornece apenas seus valores em um conjunto discreto, como os gerados em uma simulaçao computacinal, e para calcularmos a derivada analiticamente a função deve ser contínua. Então nestas situações, não podemos calcular analiticamente a derivada da função, mas podemos utilizar métodos numéricos para estimar a derivada da funçao.

## Diferenciação numérica
Suponha que estamos interessados na derivada em X=0, isto é,"F" prime de zero. Essa restrição é em prol da simplicidade, pois podemos obter as mesmas fórmulas para um "X" arbitrário através de uma translação. Vamos também supor que conhecemos "F" em uma rede igualmente espaçada de valores "X". Isso está ilustrado na imagem abaixo com os pontos regularmente espaçados por 'H'.

Então, vamos utilizar a expansão em série de Taylor-MacLaurin para interpolar a função 'F'. Os índices prime denotam a ordem da derivada avaliada em 'x=0'. O ponto de exclamação reprenta o fatorial de 'N'. No entanto, não podemos somar infinitamente, a série deve ser truncado em algum ponto, ao fazer isso cometemos um erro, a aproximação será melhor, quanto mais desprezível for este erro, em outras palavras, que fiquemos apenas com os termos mais relevantes para a aproximação no intervalo selecionado. Vamos utilizar estas definições para obtermos as fórmulas de derivadas, bem como, mais pra frente, das integrais numéricas.

O número de pontos adotados definirá a fórmula de derivada. Podemos pegar dois pontos, o próprio 'F' zero e mais ou menos um outro ponto, ou então três pontos, o 'F' zero, o próximo e o anterior. O símbolo de igual com três linhas denota que as expressão do lado direito é uma representação da outra do lado esquerdo. Queremos derivar as duas fórmulas mais simples de derivada numérica, então vamos começar pegando dois pontos, 'F' zero e 'F' 1, que vão compor a fórmula forward. Aqui, o símbolo 'O' de 'H' 4 indica que estamos descartando os termos de ordem maior ou igual a 4. Também pegamos outros dois, 'F' zero e 'F' -1, que será a backward. O que faremos é utilizar as diferenças finitas para obter as fórmulas.

Então a partir da primeira equação obtemos a fórmula de derivada de dois pontos forward ao descartar os termos de ordem maior ou igual a 'H' quadrado. Repetimos o procedimento para obtermos a fórmula backward. Podemos analisar graficamente o que está acontecendo. Tanto na fórmula backward como na forward, estaremos considerando que no intervalo entre 0 e 'H', a função possui um comportamento de uma função linear. Podemos comparar estas retas secantes com a reta tangente que representa graficamente a derivada no ponto. Podemos utilizar qualquer uma das duas fórmulas, a precisão será a mesma.

Vamos olhar agora para três fluxogramas para a derivada; de um ponto da função, de um arquivo de dados de uma função e de um array. Se conhecemos a função analítica, entramos com a função, o incremento "H" e o ponto "X" onde queremos determinar a derivada. Utilizamos a diferença finita progressiva, forward e imprimimos o resultado na tela. 

As caixas verdes representam entrada ou saída de dados, as vermelhas um processo e as amarelas uma desição lógica.

No outro caso, não temos a conhecimento da função analítica, apenas um conjunto de dados (x,y). Utilizamos a diferença finita regressiva, ou backward. A razão disso é que talvez não saibamos qual é a linha final do arquivo de dados, então ao invés de percorrermos todo o arquivo de dados pra determinar a linha final e adicionar um "IF" pra essa condição, usamos essa fórmula. O incremento será a própria diferença entre os pontos 'X'. Neste caso, não teremos apenas a derivada em um ponto, mas um conjunto de dados que reprentam a derivada da função do arquivo de dados original. Por exemplo, se o conjunto de dados for a posição "X e o tempo "T", o novo arquivo de dados será a velocidade "V" e o tempo "T". O programa vai ler as duas colunas de dados, então atribuímos isso a dois vetores, 'F' e 'H'. O programa encerra com o final do arquivo de dados. 

Por fim, podemos vetorizar esse processo. Entramos com a função 'F', o número de pontos 'N' e o incremento 'DX'. Se utilizarmos a fórmula forward, temos que ter um 'IF' quando 'I=N', pois não existe o ponto 'I=N+DX', pois o último ponto é o proprio 'i=N'.

Podemos detalhar mais um pouco os procedimentos através dos pseudocódigos. Para determinar a derivada em um ponto de uma função conhecida analiticamente, devemos primeiro definir a função 'F' de 'X', por exemplo, que ela seja igual a cosseno de 'X'. Na próxima linha, vai ler do usuário os valores de h e do ponto x. Em seguida é calcula a derivada no ponto e então impressa na tela o resultado.

Para o caso de um arquivo de dados teremos um pouco mais trabalho, mas será o caso mais recorrente na prática da pesquisa científica. O usuário deve informar o nome do arquivo de dados. Então o programa abre o arquivo de dados informado e cria um novo, que armazenará a derivada desse conjunto de pontos. Iniciamos o contador 'i'. Iniciamos um loop do tipo condicional, que encerra com o final do arquivo. O programa lê do arquivo de dados fonte, as duas colunas 'X' e 'Y'. Atribuímos isso a dois vetores 'F' e 'H', aumentamos o incremento do contador 'i'. Se 'i' é igual a 2, calculamos a derivada regressiva. Essa condição serve para incluir os dois primeiros pontos, pois precisamos do ponto anterior a derivada no ponto. Escrevemos no novo arquivo de dados a derivda e o ponto corresponte 'X'. Fazemos uma nova atribuição para 'F', 'H' e 'i' e seguimos no loop até ler a última linha do arquivo de dados.

No processo de vetorização, queremos a derivada em um certo intervalo de uma função conhecida analiticamente. Então definimos a função, por exemplo cosseno de 'X'. O usuário deve informar o número de pontos 'N' e o incremento (ou passo) 'dx'. Iniciamos um loop do tipo iterativo do primeiro até o penúltimo ponto, pois nessa fórmula utilizamos o ponto de interesse mais o ponto à frente. Então quando eu estiver calculando o penúltimo ponto, estarei de fato utilizando os dois últimos pontos da sequência. E se eu tentar calcular a derivada do último ponto, vou exceder o limite de pontos determinado pelo usuário.

A partir destas definições podemos construir tranquilamento o código. Em breve trarei as implmentações computacionais destas fórmulas. Mas você já pode tentar escrever o código, e comparar a derivada das funções conhecidas.